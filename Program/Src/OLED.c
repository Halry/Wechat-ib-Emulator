#include "OLED.h"
extern SPI_HandleTypeDef hspi2;
unsigned char F6x8[][6] =		
{
0x00, 0x00, 0x00, 0x00, 0x00, 0x00,// sp
0x00, 0x00, 0x00, 0x2f, 0x00, 0x00,// !
0x00, 0x00, 0x07, 0x00, 0x07, 0x00,// "
0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14,// #
0x00, 0x24, 0x2a, 0x7f, 0x2a, 0x12,// $
0x00, 0x62, 0x64, 0x08, 0x13, 0x23,// %
0x00, 0x36, 0x49, 0x55, 0x22, 0x50,// &
0x00, 0x00, 0x05, 0x03, 0x00, 0x00,// '
0x00, 0x00, 0x1c, 0x22, 0x41, 0x00,// (
0x00, 0x00, 0x41, 0x22, 0x1c, 0x00,// )
0x00, 0x14, 0x08, 0x3E, 0x08, 0x14,// *
0x00, 0x08, 0x08, 0x3E, 0x08, 0x08,// +
0x00, 0x00, 0x00, 0xA0, 0x60, 0x00,// ,
0x00, 0x08, 0x08, 0x08, 0x08, 0x08,// -
0x00, 0x00, 0x60, 0x60, 0x00, 0x00,// .
0x00, 0x20, 0x10, 0x08, 0x04, 0x02,// /
0x00, 0x3E, 0x51, 0x49, 0x45, 0x3E,// 0
0x00, 0x00, 0x42, 0x7F, 0x40, 0x00,// 1
0x00, 0x42, 0x61, 0x51, 0x49, 0x46,// 2
0x00, 0x21, 0x41, 0x45, 0x4B, 0x31,// 3
0x00, 0x18, 0x14, 0x12, 0x7F, 0x10,// 4
0x00, 0x27, 0x45, 0x45, 0x45, 0x39,// 5
0x00, 0x3C, 0x4A, 0x49, 0x49, 0x30,// 6
0x00, 0x01, 0x71, 0x09, 0x05, 0x03,// 7
0x00, 0x36, 0x49, 0x49, 0x49, 0x36,// 8
0x00, 0x06, 0x49, 0x49, 0x29, 0x1E,// 9
0x00, 0x00, 0x36, 0x36, 0x00, 0x00,// :
0x00, 0x00, 0x56, 0x36, 0x00, 0x00,// ;
0x00, 0x08, 0x14, 0x22, 0x41, 0x00,// <
0x00, 0x14, 0x14, 0x14, 0x14, 0x14,// =
0x00, 0x00, 0x41, 0x22, 0x14, 0x08,// >
0x00, 0x02, 0x01, 0x51, 0x09, 0x06,// ?
0x00, 0x32, 0x49, 0x59, 0x51, 0x3E,// @
0x00, 0x7C, 0x12, 0x11, 0x12, 0x7C,// A
0x00, 0x7F, 0x49, 0x49, 0x49, 0x36,// B
0x00, 0x3E, 0x41, 0x41, 0x41, 0x22,// C
0x00, 0x7F, 0x41, 0x41, 0x22, 0x1C,// D
0x00, 0x7F, 0x49, 0x49, 0x49, 0x41,// E
0x00, 0x7F, 0x09, 0x09, 0x09, 0x01,// F
0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A,// G
0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F,// H
0x00, 0x00, 0x41, 0x7F, 0x41, 0x00,// I
0x00, 0x20, 0x40, 0x41, 0x3F, 0x01,// J
0x00, 0x7F, 0x08, 0x14, 0x22, 0x41,// K
0x00, 0x7F, 0x40, 0x40, 0x40, 0x40,// L
0x00, 0x7F, 0x02, 0x0C, 0x02, 0x7F,// M
0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F,// N
0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E,// O
0x00, 0x7F, 0x09, 0x09, 0x09, 0x06,// P
0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E,// Q
0x00, 0x7F, 0x09, 0x19, 0x29, 0x46,// R
0x00, 0x46, 0x49, 0x49, 0x49, 0x31,// S
0x00, 0x01, 0x01, 0x7F, 0x01, 0x01,// T
0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F,// U
0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F,// V
0x00, 0x3F, 0x40, 0x38, 0x40, 0x3F,// W
0x00, 0x63, 0x14, 0x08, 0x14, 0x63,// X
0x00, 0x07, 0x08, 0x70, 0x08, 0x07,// Y
0x00, 0x61, 0x51, 0x49, 0x45, 0x43,// Z
0x00, 0x00, 0x7F, 0x41, 0x41, 0x00,// [
0x00, 0x55, 0x2A, 0x55, 0x2A, 0x55,// 55
0x00, 0x00, 0x41, 0x41, 0x7F, 0x00,// ]
0x00, 0x04, 0x02, 0x01, 0x02, 0x04,// ^
0x00, 0x40, 0x40, 0x40, 0x40, 0x40,// _
0x00, 0x00, 0x01, 0x02, 0x04, 0x00,// '
0x00, 0x20, 0x54, 0x54, 0x54, 0x78,// a
0x00, 0x7F, 0x48, 0x44, 0x44, 0x38,// b
0x00, 0x38, 0x44, 0x44, 0x44, 0x20,// c
0x00, 0x38, 0x44, 0x44, 0x48, 0x7F,// d
0x00, 0x38, 0x54, 0x54, 0x54, 0x18,// e
0x00, 0x08, 0x7E, 0x09, 0x01, 0x02,// f
0x00, 0x18, 0xA4, 0xA4, 0xA4, 0x7C,// g
0x00, 0x7F, 0x08, 0x04, 0x04, 0x78,// h
0x00, 0x00, 0x44, 0x7D, 0x40, 0x00,// i
0x00, 0x40, 0x80, 0x84, 0x7D, 0x00,// j
0x00, 0x7F, 0x10, 0x28, 0x44, 0x00,// k
0x00, 0x00, 0x41, 0x7F, 0x40, 0x00,// l
0x00, 0x7C, 0x04, 0x18, 0x04, 0x78,// m
0x00, 0x7C, 0x08, 0x04, 0x04, 0x78,// n
0x00, 0x38, 0x44, 0x44, 0x44, 0x38,// o
0x00, 0xFC, 0x24, 0x24, 0x24, 0x18,// p
0x00, 0x18, 0x24, 0x24, 0x18, 0xFC,// q
0x00, 0x7C, 0x08, 0x04, 0x04, 0x08,// r
0x00, 0x48, 0x54, 0x54, 0x54, 0x20,// s
0x00, 0x04, 0x3F, 0x44, 0x40, 0x20,// t
0x00, 0x3C, 0x40, 0x40, 0x20, 0x7C,// u
0x00, 0x1C, 0x20, 0x40, 0x20, 0x1C,// v
0x00, 0x3C, 0x40, 0x30, 0x40, 0x3C,// w
0x00, 0x44, 0x28, 0x10, 0x28, 0x44,// x
0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C,// y
0x00, 0x44, 0x64, 0x54, 0x4C, 0x44,// z
0x14, 0x14, 0x14, 0x14, 0x14, 0x14,// horiz lines
};

	
void OLED_DrawBMP(uint8_t x0, uint8_t y0,uint8_t x1, uint8_t y1,const uint8_t* BMP)
{ 	
 unsigned int j=0;
 unsigned char x,y;
  
  if(y1%8==0) y=y1/8;      
  else y=y1/8+1;
	for(y=y0;y<y1;y++)
	{
		OLED_Set_Pos(x0,y);
    for(x=x0;x<x1;x++)
	    {      
	    	OLED_WR_Byte(BMP[j++],OLED_DATA_FLAG);	    	
	    }
	}
} 
void OLED_WR_Byte(uint8_t data,bool cmd_flag)
{
	
	if(cmd_flag)
		OLED_DC_SET();
	else
		OLED_DC_CLR();
	HAL_SPI_Transmit(&hspi2,&data,1,0xFF);
	OLED_DC_SET(); 
}
void OLED_WR_R_Byte(uint8_t data,bool cmd_flag)
{
	uint8_t i;
	i=~data;
	if(cmd_flag)
		OLED_DC_SET();
	else
		OLED_DC_CLR();
	HAL_SPI_Transmit(&hspi2,&i,1,0xFF);
	OLED_DC_SET(); 
}
void OLED_ShowChar(uint8_t x,uint8_t y,uint8_t chr)
{      	
	unsigned char c=0,i=0;	
		c=chr-' ';//???????			
		if(x>Max_Column-1){x=0;y=y+2;}
		
				OLED_Set_Pos(x,y);
				for(i=0;i<6;i++)
				OLED_WR_Byte(F6x8[c][i],OLED_DATA_FLAG);
			
}
void OLED_R_ShowChar(uint8_t x,uint8_t y,uint8_t chr)
{      	
	unsigned char c=0,i=0;	
		c=chr-' ';//???????			
		if(x>Max_Column-1){x=0;y=y+2;}
		
				OLED_Set_Pos(x,y);
				for(i=0;i<6;i++)
				OLED_WR_R_Byte(F6x8[c][i],OLED_DATA_FLAG);
			
}
void OLED_ShowString(uint8_t x,uint8_t y,const uint8_t *chr)
{
	unsigned char j=0;
	while (chr[j]!='\0')
	{		OLED_ShowChar(x,y,chr[j]);
			x+=6;
		if(x>120){x=0;y+=2;}
			j++;
	}
}
void OLED_R_ShowString(uint8_t x,uint8_t y,const uint8_t *chr)
{
	unsigned char j=0;
	while (chr[j]!='\0')
	{		OLED_R_ShowChar(x,y,chr[j]);
			x+=8;
		if(x>120){x=0;y+=2;}
			j++;
	}
}
void OLED_ShowChinese(uint8_t x,uint8_t y,const uint8_t *chinese)
{      			    
	uint8_t addr=0;
	OLED_Set_Pos(x,y);	
    for(uint8_t t=0;t<16;t++)
		{
				OLED_WR_Byte(*(chinese+addr),OLED_DATA_FLAG);
				addr+=1;
     }	
		OLED_Set_Pos(x,y+1);	
    for(uint8_t t=0;t<16;t++)
			{	
				OLED_WR_Byte(*(chinese+addr),OLED_DATA_FLAG);
				addr+=1;
      }					
}
void OLED_Init(void)
{
	OLED_RST_SET();
	HAL_Delay(100);
	OLED_RST_CLR();
	HAL_Delay(100);
	OLED_RST_SET();
	//Reset the OLED Panel
	OLED_WR_Byte(0xAE,OLED_CMD_FLAG);
	OLED_WR_Byte(0x00,OLED_CMD_FLAG);//---set low column address
	OLED_WR_Byte(0x10,OLED_CMD_FLAG);//---set high column address
	OLED_WR_Byte(0x40,OLED_CMD_FLAG);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
	OLED_WR_Byte(0x81,OLED_CMD_FLAG);//--set contrast control register
	OLED_WR_Byte(0xCF,OLED_CMD_FLAG); // Set SEG Output Current Brightness
	OLED_WR_Byte(0xA1,OLED_CMD_FLAG);//--Set SEG/Column Mapping     0xa0 0xa1
	OLED_WR_Byte(0xC8,OLED_CMD_FLAG);//Set COM/Row Scan Direction   0xc0 0xc8
	OLED_WR_Byte(0xA6,OLED_CMD_FLAG);//--set normal display
	OLED_WR_Byte(0xA8,OLED_CMD_FLAG);//--set multiplex ratio(1 to 64)
	OLED_WR_Byte(0x3f,OLED_CMD_FLAG);//--1/64 duty
	OLED_WR_Byte(0xD3,OLED_CMD_FLAG);//-set display offset	Shift Mapping RAM Counter (0x00~0x3F)
	OLED_WR_Byte(0x00,OLED_CMD_FLAG);//-not offset
	OLED_WR_Byte(0xd5,OLED_CMD_FLAG);//--set display clock divide ratio/oscillator frequency
	OLED_WR_Byte(0x80,OLED_CMD_FLAG);//--set divide ratio, Set Clock as 100 Frames/Sec
	OLED_WR_Byte(0xD9,OLED_CMD_FLAG);//--set pre-charge period
	OLED_WR_Byte(0xF1,OLED_CMD_FLAG);//Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
	OLED_WR_Byte(0xDA,OLED_CMD_FLAG);//--set com pins hardware configuration
	OLED_WR_Byte(0x12,OLED_CMD_FLAG);
	OLED_WR_Byte(0xDB,OLED_CMD_FLAG);//--set vcomh
	OLED_WR_Byte(0x40,OLED_CMD_FLAG);//Set VCOM Deselect Level
	OLED_WR_Byte(0x20,OLED_CMD_FLAG);//-Set Page Addressing Mode (0x00/0x01/0x02)
	OLED_WR_Byte(0x02,OLED_CMD_FLAG);//
	OLED_WR_Byte(0x8D,OLED_CMD_FLAG);//--set Charge Pump enable/disable
	OLED_WR_Byte(0x14,OLED_CMD_FLAG);//--set(0x10) disable
	OLED_WR_Byte(0xA4,OLED_CMD_FLAG);// Disable Entire Display On (0xa4/0xa5)
	OLED_WR_Byte(0xA6,OLED_CMD_FLAG);// Disable Inverse Display On (0xa6/a7) 
	OLED_WR_Byte(0xAF,OLED_CMD_FLAG);//--turn on oled panel
	OLED_WR_Byte(0xAF,OLED_CMD_FLAG); /*display ON*/ 
	
	OLED_Clear();
	OLED_Set_Pos(0,0); 	
}
void OLED_Set_Pos(uint8_t x, uint8_t y) 
{ 
	OLED_WR_Byte(0xb0+y,OLED_CMD_FLAG);
	OLED_WR_Byte(((x&0xf0)>>4)|0x10,OLED_CMD_FLAG);
	OLED_WR_Byte((x&0x0f)|0x01,OLED_CMD_FLAG); 
}   	
void OLED_Clear(void)  
{  
	uint8_t i,n;		    
	for(i=0;i<8;i++)  
	{  
		OLED_WR_Byte (0xb0+i,OLED_CMD_FLAG);    
		OLED_WR_Byte (0x00,OLED_CMD_FLAG);      
		OLED_WR_Byte (0x10,OLED_CMD_FLAG);        
		for(n=0;n<128;n++)OLED_WR_Byte(0,OLED_DATA_FLAG); 
	} 
}
